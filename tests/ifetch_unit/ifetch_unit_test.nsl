#include "ifetch_unit.h"
#include "wishbone_syscon.h"
#include "ram64x8K.h"

declare ifetch_unit_test simulation {
	input newpc[32];
	func_in redirect(newpc);
	output fetch_packet[96];
	func_out push2(fetch_packet);
}

module ifetch_unit_test {
	ifetch_unit ifu;
	wishbone_syscon wb_syscon;
	ram64x8K ram;
	reg r = 0;

	wb_syscon.CLK_I = m_clock;
	wb_syscon.RST_I = p_reset;

	if(~r) {
		r := ~r;
		ifu.reset();
		ram.reset();
	}
	func redirect {
		ifu.redirect(newpc);
	}
	func ifu.push2 {
		push2(ifu.fetch_packet);
	}
	WISHBONE_P2P(ifu, ram, wb_syscon);
}
